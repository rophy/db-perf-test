apiVersion: apps/v1
kind: Deployment
metadata:
  name: hammerdb
  namespace: yugabyte-test
  labels:
    app: hammerdb
spec:
  replicas: 1
  selector:
    matchLabels:
      app: hammerdb
  template:
    metadata:
      labels:
        app: hammerdb
    spec:
      containers:
        - name: hammerdb
          image: tpcorg/hammerdb:v4.12
          command: ["/bin/bash", "/scripts/entrypoint.sh", "sleep"]
          env:
            # Database connection
            - name: PG_HOST
              value: "yb-tserver-service"
            - name: PG_PORT
              value: "5433"
            # Superuser credentials
            - name: PG_SUPERUSER
              value: "yugabyte"
            - name: PG_SUPERPASS
              value: "yugabyte"
            - name: PG_DEFAULTDBASE
              value: "yugabyte"
            # TPCC user credentials
            - name: PG_USER
              value: "tpcc"
            - name: PG_PASS
              value: "tpcc"
            - name: PG_DBASE
              value: "tpcc"
            # Benchmark settings
            - name: HAMMERDB_WAREHOUSES
              value: "4"
            - name: HAMMERDB_VUS
              value: "4"
            - name: HAMMERDB_DURATION
              value: "5"
            - name: HAMMERDB_RAMPUP
              value: "1"
          resources:
            requests:
              cpu: "500m"
              memory: "1Gi"
            limits:
              cpu: "2"
              memory: "2Gi"
          volumeMounts:
            - name: scripts
              mountPath: /scripts
      volumes:
        - name: scripts
          configMap:
            name: hammerdb-scripts
            defaultMode: 0755
